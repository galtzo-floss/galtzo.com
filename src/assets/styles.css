:root {
    /* =========================================================================
       COLOR SYSTEM
       ========================================================================= */

    /* Base colors */
    --text-color: #111;
    --border-color: #eee;
    --background-light: #eee;

    /* Tag contrast tuning: outer pill (host) vs inner pill (label) and the left edge */
    --tag-outer-bg: var(--background-light);
    /* Make inner pill a touch closer to the control surface so it reads as a separate layer
       but still adapts to light/dark themes via --card-bg and --control-border. */
    --tag-inner-bg: color-mix(in oklab, var(--card-bg) 88%, var(--control-border) 12%);
    /* Strong left edge color for the inner pill (used as border-left) */
    --tag-inner-edge: color-mix(in oklab, var(--control-border) 75%, black 5%);

    /* Centralized orange variables (edit these to change orange across themes) */
    --orange-base: rgba(204, 74, 0, 0.8);      /* darker than previous rgba(255,100,0,0.8) */
    --orange-light-base: rgba(204, 74, 0, 0.4);
    --orange-solid-base: #cc4a00; /* darker than #e05500 (light-theme solid) */
    /* Two-tone orange border stops (top, bottom) derived from the active solid by default */
    --orange-top: color-mix(in oklab, var(--orange-solid) 20%, white);
    --orange-bottom: color-mix(in oklab, var(--orange-solid) 85%, black 10%);

    /* Dark-theme orange variants (used when dark visuals are active) */
    --orange-base-dark: rgba(184, 134, 0, 0.35); /* darker warm amber for dark theme */
    --orange-light-base-dark: rgba(184, 134, 0, 0.25);
    --orange-solid-dark: #b88600; /* darker than #e09b00 (dark-theme solid) */

    /* Active variables used throughout the stylesheet - these reference the chosen variant */
    --orange: var(--orange-base);
    --orange-light: var(--orange-light-base);
    --orange-solid: var(--orange-solid-base);
    /* Active state palette: default to the dark-mode orange variants so
       light-mode uses the same visual for active pills as dark mode. */
    --orange-active: var(--orange-base-dark);
    --orange-active-light: var(--orange-light-base-dark);
    --orange-active-solid: var(--orange-solid-dark);
    /* Two-tone stops for the active border (derived from active-solid) */
    --orange-top-active: color-mix(in oklab, var(--orange-active-solid) 20%, white);
    --orange-bottom-active: color-mix(in oklab, var(--orange-active-solid) 85%, black 10%);
    --white: white;
    --transparent: transparent;

    /* Role color palette: base solids + lighter glow variants */
    --author-solid: #dc2626; /* red */
    --author-color: color-mix(in oklab, var(--author-solid) 90%, white);

    --maintainer-solid: #16a34a; /* green */
    --maintainer-color: color-mix(in oklab, var(--maintainer-solid) 90%, white);

    --contributor-solid: #8b5cf6; /* purple */
    --contributor-color: color-mix(in oklab, var(--contributor-solid) 90%, white);

    /* Theme surfaces (light default) */
    --page-bg: #ffffff;
    --card-bg: #ffffff;
    --muted-bg: #f6f7f9;
    --control-bg: #f1f5f9;
    --control-hover-bg: #e2e8f0;
    --control-border: #cbd5e1;
    --control-text: #0f172a;

    /* =========================================================================
       TYPOGRAPHY
       ========================================================================= */

    --font-family-base: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    --font-size-xs: 0.75rem;        /* 12px - tags, counts, small text */
    --font-size-sm: 0.875rem;       /* 14px - link icons, secondary text */
    --font-size-base: 0.9rem;       /* 14.4px - role banner, theme toggle */
    --font-size-corner-banner: 14px; /* corner banners (fork/clone) */
    --font-weight-normal: 600;      /* default weight for tags and controls */
    --font-weight-bold: 700;        /* corner banners */
    --line-height-tight: 1;         /* compact elements */

    /* =========================================================================
       SPACING & LAYOUT
       ========================================================================= */

    /* Page layout */
    --page-max-width: 48rem;        /* 768px - main content column width */
    --page-margin-y: 2rem;          /* top/bottom margin for body */
    --page-padding-x: 1rem;         /* left/right padding for body */

    /* Component spacing */
    --header-margin-bottom: 1rem;
    --h1-padding-bottom: 0.25rem;
    --h1-column-gap: 1rem;          /* space between title text and first pill */
    --h1-row-gap: 0.5rem;           /* vertical gap when pills wrap */
    --h2-margin-top: 0.2rem;
    --h2-margin-bottom: 0.1rem;

    /* Card system */
    --card-width: 450px;
    --card-padding: 1rem;
    --card-border-width: 1px;
    --card-border-radius: 4px;
    --card-gap: 0.7rem 1rem;        /* row-gap column-gap for project-list */

    /* =========================================================================
       BORDER & RADIUS
       ========================================================================= */

    --border-width-thin: 1px;
    --border-width-tag: 2px;
    --border-width-tag-edge: 3px;   /* left edge of inner pill */
    --border-radius-sm: 4px;
    --border-radius-pill: 9999px;
    --border-radius-panel: 8px;
    --border-radius-accent: 3px;    /* banner role accent stripe */

    /* =========================================================================
       SHADOWS & GLOWS
       ========================================================================= */

    --shadow-glow-sm: 0 0 8px;      /* subtle inner shadow */
    --shadow-glow-md: 0 0 10px;     /* standard glow for tags/controls */
    --shadow-corner-banner: 0 2px 4px rgba(0,0,0,0.3);
    --shadow-panel: 0 10px 30px rgba(0,0,0,0.12); /* filter dropdown panels */
    --shadow-inner-role: inset 0 -6px 12px -8px; /* role banner inner glow */

    /* =========================================================================
       TRANSITIONS & ANIMATIONS
       ========================================================================= */

    --transition-fast: 150ms linear;
    --transition-medium: 0.3s ease;
    --transition-caret: 0.18s ease;
    --transition-tag-margin: margin-left 0.3s ease;
    --transition-tag-colors: background-color 150ms linear, border-color 150ms linear;

    /* =========================================================================
       TAG SYSTEM
       ========================================================================= */

    /* Tag padding (inner pills) */
    --tag-padding-card: 0.3rem 0.75rem;  /* tags inside cards */
    --tag-padding-filter: 0.3rem 1rem 0.3rem 1.75rem; /* tags in filter lists */

    /* Tag margins for slide animation */
    --tag-margin-inactive: 1.5rem;  /* left margin when not active */
    --tag-margin-active-left: 0;    /* slides left when active */
    --tag-margin-active-right: 1.5rem; /* right margin when active */

    /* Tag negative margin for card tags */
    --tag-card-margin: -0.1rem 0.5rem 0 0;

    /* =========================================================================
       TAG-LIST & FILTERS
       ========================================================================= */

    --tag-list-gap: 1.1rem 0.8rem;  /* row-gap column-gap */
    --tag-list-summary-gap: 0.6rem 0.9rem; /* inside summary controls */
    --tag-list-scroll-padding: 0.75rem 0.9rem; /* vertical horizontal */
    --filters-gap: 0.75rem;
    --filters-margin-bottom: 0.75rem;
    --filter-panel-offset: 0.6rem;  /* gap between summary and dropdown */
    --filter-panel-padding: 0.6rem;
    --filter-panel-gap: 0.7rem 1rem; /* row-gap column-gap inside panels */
    --filter-panel-max-height: 60vh;
    --filter-panel-col-min: 9rem;   /* min column width in grid */
    --filter-panel-col-min-mobile: 7.5rem; /* smaller on mobile */

    /* =========================================================================
       COUNT BADGES
       ========================================================================= */

    --count-top: 0.5rem;
    --count-padding: 0 0.5rem;
    --count-z-visible: 1;
    --count-z-hidden: -1;
    --count-opacity-visible: 1;
    --count-opacity-hidden: 0;

    /* =========================================================================
       ICON SIZING
       ========================================================================= */

    --icon-size-md: 20px;           /* link icons */
    --icon-size-sm: 14px;           /* language icons */
    --icon-padding-md: 0.3rem 0.5rem; /* link icons */
    --icon-padding-sm: 0.1rem 0.1rem; /* language icons */
    --icon-margin-right: 0.5rem;
    --icon-margin-right-sm: 0.1rem;
    --icon-margin-bottom-sm: -0.2rem;

    /* =========================================================================
       CARET INDICATOR (summary controls)
       ========================================================================= */

    --caret-size: 6px;
    --caret-gap: 0.5rem;
    --caret-margin: 0.25rem;

    /* =========================================================================
       THEME TOGGLE BUTTON
       ========================================================================= */

    --toggle-padding: 0.375rem 0.625rem;

    /* =========================================================================
       BANNER RIBBONS (corner & role bars)
       ========================================================================= */

    --ribbon-length: 1200px;           /* long enough to cover the card diagonally */
    --corner-gap: 10px;                /* small padding so text isn't flush with corner */
    --ribbon-stack-gap: 28px;          /* distance between the two ribbons along the diagonal */
    --ribbon-width: 720px;      /* length of each ribbon */
    --ribbon-top: 12px;         /* distance from top edge for the first ribbon */
    --ribbon-right: -332px;     /* center horizontally ~40px inside along diagonal */
    --ribbon-gap: 18px;         /* vertical gap between the two ribbons */
    --ribbon-padding: 9px 0;    /* vertical padding for corner banners */

    /* Role-specific fine-tuning */
    --role-gap-extra: 9px;     /* extra separation from the fork banner */
    --role-right-adjust: 9px;   /* keep aligned horizontally with the fork banner */

    /* Role bar (horizontal banner at top of card) */
    --rolebar-height: 2.25rem; /* controls the height of the horizontal role bar */
    --rolebar-padding-x: 0.75rem; /* left/right padding */
    --fork-notch: 3.5rem;      /* space reserved on the right under fork ribbon */

    /* Role bar accent stripe */
    --role-accent-left: 0.25rem;
    --role-accent-top: 0.375rem;
    --role-accent-bottom: 0.375rem;
    --role-accent-width: 6px;
    --role-accent-opacity: 0.12;
    --role-accent-z: 11;

    /* Role color mixing percentages */
    --role-bg-mix: 8%;          /* how much role color to mix with card bg */

    /* =========================================================================
       Z-INDEX LAYERS
       ========================================================================= */

    --z-corner-banner: 10;
    --z-fork-banner: 11;
    --z-role-banner: 10;
    --z-filter-panel: 60;
}

/* System default: dark mode variables */
@media (prefers-color-scheme: dark) {
    :root {
        --text-color: #e5e7eb;
        --border-color: #2a2f3a;
        --background-light: #1f2730;

        /* Wire dark visual system to the centralized dark orange variants */
        --orange: var(--orange-base-dark);
        --orange-light: var(--orange-light-base-dark);
        --orange-solid: var(--orange-solid-dark);
        /* In dark mode the active palette should follow the dark orange values */
        --orange-active: var(--orange);
        --orange-active-light: var(--orange-light);
        --orange-active-solid: var(--orange-solid);
        --orange-top-active: color-mix(in oklab, var(--orange-active-solid) 20%, white);
        --orange-bottom-active: color-mix(in oklab, var(--orange-active-solid) 85%, black 10%);

        --page-bg: #0b0f14;
        --card-bg: #111827;
        --muted-bg: #111827;
        --control-bg: #1f2937;
        --control-hover-bg: #374151;
        --control-border: #334155;
        --control-text: #e5e7eb;
    }
}

/* Forced overrides via attribute on <html> */
:root[data-theme="light"] {
    --text-color: #111;
    --border-color: #eee;
    --background-light: #eee;

    /* Explicit light theme maps back to the centralized light base values */
    --orange: var(--orange-base);
    --orange-light: var(--orange-light-base);
    --orange-solid: var(--orange-solid-base);
    /* Make active pills in light mode use the dark-mode active colors */
    --orange-active: var(--orange-base-dark);
    --orange-active-light: var(--orange-light-base-dark);
    --orange-active-solid: var(--orange-solid-dark);
    --orange-top-active: color-mix(in oklab, var(--orange-active-solid) 20%, white);
    --orange-bottom-active: color-mix(in oklab, var(--orange-active-solid) 85%, black 10%);

    --page-bg: #ffffff;
    --card-bg: #ffffff;
    --muted-bg: #f6f7f9;
    --control-bg: #f1f5f9;
    --control-hover-bg: #e2e8f0;
    --control-border: #cbd5e1;
    --control-text: #0f172a;
}

:root[data-theme="dark"] {
    --text-color: #e5e7eb;
    --border-color: #2a2f3a;
    --background-light: #1f2730;

    /* Explicit dark theme maps to the centralized dark base values */
    --orange: var(--orange-base-dark);
    --orange-light: var(--orange-light-base-dark);
    --orange-solid: var(--orange-solid-dark);
    /* Ensure active palette follows dark values as well */
    --orange-active: var(--orange);
    --orange-active-light: var(--orange-light);
    --orange-active-solid: var(--orange-solid);
    --orange-top-active: color-mix(in oklab, var(--orange-active-solid) 20%, white);
    --orange-bottom-active: color-mix(in oklab, var(--orange-active-solid) 85%, black 10%);

    --page-bg: #0b0f14;
    --card-bg: #111827;
    --muted-bg: #111827;
    --control-bg: #1f2937;
    --control-hover-bg: #374151;
    --control-border: #334155;
    --control-text: #e5e7eb;
}

/* =========================================================================
   ROLE COLOR SYSTEM - Scoped Variables
   Define role-specific colors once, then reference generically
   ========================================================================= */

.author {
    --current-role-solid: var(--author-solid);
    --current-role-color: var(--author-color);
}

.maintainer {
    --current-role-solid: var(--maintainer-solid);
    --current-role-color: var(--maintainer-color);
}

.contributor {
    --current-role-solid: var(--contributor-solid);
    --current-role-color: var(--contributor-color);
}

/* =========================================================================
   BASE STYLES
   ========================================================================= */

body {
    font-family: var(--font-family-base);
    max-width: var(--page-max-width);
    margin: var(--page-margin-y) auto;
    padding: 0 var(--page-padding-x);
    color: var(--text-color);
    background: var(--page-bg);
}

header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: var(--header-margin-bottom);
}

.theme-toggle {
    appearance: none;
    background: var(--control-bg);
    color: var(--control-text);
    border: var(--border-width-thin) solid var(--control-border);
    border-radius: var(--border-radius-pill);
    padding: var(--toggle-padding);
    font-size: var(--font-size-base);
    line-height: 1;
    cursor: pointer;
    box-shadow: var(--shadow-glow-md) var(--orange-light);
}
.theme-toggle:hover {
    background: var(--control-hover-bg);
}

h1 {
    border-bottom: var(--border-width-thin) solid var(--border-color);
    padding-bottom: var(--h1-padding-bottom);
    display: flex;
    align-items: baseline;   /* keep pills aligned with the text baseline on wide screens */
    column-gap: var(--h1-column-gap);        /* space between title text and first pill */
    row-gap: var(--h1-row-gap);         /* vertical gap when pills wrap to the next line */
    flex-wrap: wrap;         /* allow pills to drop below the title when needed */
}

h2 {
    margin-top: var(--h2-margin-top);
    margin-bottom: var(--h2-margin-bottom);
}

li {
    margin: 0;
}

a.text-link {
    display: inline-block;
    text-decoration: underline;
    color: var(--orange-solid);
}

.link-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--border-radius-sm);
    text-decoration: none;
    color: inherit;
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-normal);
    width: var(--icon-size-md);
    height: var(--icon-size-md);
    box-shadow: var(--shadow-glow-md) var(--orange);
    background-color: var(--orange);
    padding: var(--icon-padding-md);
    margin-right: var(--icon-margin-right);
}

.min-language {
    .language {
        width: var(--icon-size-sm);
        height: var(--icon-size-sm);
        padding: var(--icon-padding-sm);
        margin-right: var(--icon-margin-right-sm);
        margin-bottom: var(--icon-margin-bottom-sm);
        box-shadow: none;
        background-color: var(--transparent);
    }
}

a {
    text-decoration: none;
    color: inherit;
}

/* Prevent wrapping inside all buttons and button-like elements */
button,
.tag-link {
    white-space: nowrap;
}

.project-list {
    display: flex;
    flex-wrap: wrap;
    gap: var(--card-gap);
    list-style: none;
    padding: 0;
}

.card {
    width: var(--card-width);
    box-sizing: border-box;
    border: var(--border-width-thin) solid var(--border-color);
    padding: var(--card-padding);
    /* Ensure content clears the horizontal role bar at the top */
    padding-top: calc(var(--card-padding) + var(--rolebar-height));
    border-radius: var(--border-radius-sm);
    position: relative;
    overflow: hidden;
    background: var(--card-bg);

    .tag {
        display: inline-block;
        /* inner pill sits visually above the host pill */
        background-color: var(--tag-inner-bg);
        border-radius: var(--border-radius-pill);
        padding: var(--tag-padding-card);
        font-size: var(--font-size-xs);
        font-weight: var(--font-weight-normal);
        margin: var(--tag-card-margin);
        /* subtle glow and a thin left edge to separate from the outer pill */
        box-shadow: var(--shadow-glow-md) rgba(0,0,0,0.04), 0 0 10px var(--orange-light);
        border-left: var(--border-width-tag-edge) solid var(--tag-inner-edge);
    }

    /* Consolidated: role-colored tags using scoped variables */
    .tag:is(.author, .maintainer, .contributor) {
        box-shadow: 0 0 10px var(--current-role-color);
    }
}

/* Project card positioning for corner banners */
.card {
    position: relative;
    overflow: hidden;
}

/* Absolute + rotate recipe anchored to the card */
.card .corner-banner {
    position: absolute;
    width: var(--ribbon-width);
    padding: var(--ribbon-padding);
    text-align: center;
    font-weight: var(--font-weight-bold);
    font-size: var(--font-size-corner-banner);
    color: #fff;
    text-decoration: none;
    transform: rotate(45deg);
    transform-origin: 50% 50%;
    white-space: nowrap;
    box-shadow: var(--shadow-corner-banner);
    z-index: var(--z-corner-banner);
    /* Center content precisely */
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
}

/* Fork/Clone (closest to corner) */
.card .banner-fork {
    top: var(--ribbon-top);
    right: var(--ribbon-right);
    background: linear-gradient(135deg, #1e5799 0%, #2989d8 50%, #207cca 100%);
    z-index: var(--z-fork-banner);
}

/* Role banner: convert to a full-width horizontal bar across the top of the card */
.card .banner-role {
    /* override ribbon defaults */
    transform: none;
    transform-origin: initial;
    white-space: normal;

    /* full-width bar at top */
    top: 0;
    left: 0;
    right: 0;
    width: 100%;
    height: var(--rolebar-height);
    /* extra right padding to avoid fork ribbon overlap visually */
    padding: 0 calc(0.75rem + var(--fork-notch)) 0 0.75rem;

    /* reset size from ribbon values */
    font-size: 0.9rem;
    line-height: var(--rolebar-height);

    /* layout contents: label left, since-year right */
    justify-content: space-between;

    /* layering: must sit under the fork ribbon on the right */
    z-index: var(--z-role-banner);

    /* shape to match card corners */
    border-top-left-radius: var(--border-radius-sm);
    border-top-right-radius: var(--border-radius-sm);
}

/* Role bar content styles */
.card .banner-role .role-label,
.card .banner-role .role-start {
    display: inline-flex;
    align-items: center;
    line-height: 1;
}
.card .banner-role a {
    color: inherit; /* uses white from corner-banner */
    text-decoration: none;
}
.card .banner-role a:hover {
    text-decoration: underline;
}

/* Consolidated: subtle role tint for horizontal bar using scoped variables */
.card:is(.author, .maintainer, .contributor).banner-role,
.card:is(.author, .maintainer, .contributor) .banner-role {
    background: color-mix(in oklab, var(--current-role-solid) 8%, var(--card-bg));
    box-shadow: inset 0 -6px 12px -8px var(--current-role-color);
    color: var(--text-color);
}

/* Consolidated: left accent stripe using scoped variables */
.card .banner-role::before {
    content: "";
    position: absolute;
    left: 0.25rem;
    top: 0.375rem;
    bottom: 0.375rem;
    width: 6px;
    border-radius: 3px;
    background: transparent;
    z-index: 11;
}

.card:is(.author, .maintainer, .contributor) .banner-role::before {
    background: var(--current-role-solid);
    opacity: 0.12;
}

/* Hide cartain tags inside project cards but keep them in the DOM for filtering.
   This uses an "sr-only" / visually-hidden pattern so JS and assistive tech can
   still access the text if needed. Can be added to any tag to hide it visually while
   keeping it available to scripts. Use on .tag elements: <span class="tag foo filter-hidden"> */
.tag.filter-hidden {
    position: absolute !important;
    width: 1px !important;
    height: 1px !important;
    padding: 0 !important;
    margin: -1px !important;
    overflow: hidden !important;
    clip: rect(0 0 0 0) !important;
    clip-path: inset(50%) !important;
    white-space: nowrap !important;
    border: 0 !important;
}

/* =========================================================================
   UTILITY CLASSES
   ========================================================================= */

/* Consolidated: standalone role classes with scoped variables
   These provide glows for elements that have role classes but aren't nested */
:is(.author, .maintainer, .contributor) {
    box-shadow: 0 0 10px var(--current-role-color);
}

/* Projects container */
.projects {
    max-width: none;
}

/* Ensure pills don't use any upward shift by default (helps small viewports) */
h1 .tag-list {
    transform: none;
    margin-left: 0;
}

/* Remove mobile-specific overrides no longer needed due to flex wrapping */
/* (intentionally left blank to avoid conflicting rules) */

/* =========================================================================
   TAG-LIST SYSTEM (Filter Pills)
   ========================================================================= */

.tag-list {
    display: inline-flex;
    flex-wrap: wrap;
    gap: var(--tag-list-gap);
    list-style: none;
    padding: 0;

    > * {
        margin: 0;
    }

    .tag {
        display: inline-block;
        background-color: var(--tag-inner-bg);
        border-radius: var(--border-radius-pill);
        padding: var(--tag-padding-filter);
        font-size: var(--font-size-xs);
        font-weight: var(--font-weight-normal);
        margin-left: 1.5rem;
        margin-right: 0;
        border: var(--border-width-tag) solid var(--transparent);
        /* keep the outer orange glow but make inner subtle to distinguish layers */
        box-shadow: var(--shadow-glow-md) rgba(0,0,0,0.04), 0 0 10px var(--orange-light);
        transition: margin-left 0.3s ease;
    }

    /* Consolidated: role-colored tags in tag-list using scoped variables */
    .tag:is(.author, .maintainer, .contributor) {
        box-shadow: 0 0 10px var(--current-role-color);
    }

    .tag-link {
        display: inline-block;
        background-color: var(--tag-outer-bg);
        border-radius: var(--border-radius-pill);
        /*padding: 0.3rem 1rem 0.3rem 1.75rem;*/
        box-shadow: 0 0 10px var(--orange-light);
        text-decoration: none;
        color: inherit;
        /*margin: 0 0.5rem 0 0;*/
        position: relative;

        /* Let the browser handle vertical panning natively: improves
           touch gesture detection and prevents accidental taps during
           vertical scroll. This is intentionally set on the source CSS
           only; do not modify generated files. */
        touch-action: pan-y;

        /* two-tone border using layered backgrounds and background-clip */
        border: var(--border-width-tag) solid transparent; /* keep a physical border width for layout */
        background-image: linear-gradient(var(--tag-outer-bg), var(--tag-outer-bg)), linear-gradient(to bottom, var(--orange-top), var(--orange-bottom));
        background-origin: border-box;
        background-clip: padding-box, border-box;
    }

    /* When active, inner background is orange while border remains two-tone orange */
    .tag-link.active {
        background-image: linear-gradient(var(--orange-active), var(--orange-active)), linear-gradient(to bottom, var(--orange-top-active), var(--orange-bottom-active));
    }

    /* Make decorative summary controls show a pointer so they feel clickable
       while remaining non-interactive elements that let summary handle the
       native toggle behavior. */
    .summary-control {
        cursor: pointer;
    }

    /* Summary / Details: show summary contents in a single horizontal row, with
       the expanded details panel appearing below the same row when open. */
    details {
        display: block;
        margin: 0;
        /* Ensure summary allows child glows/shadows to show outside its box */
        overflow: visible;
    }

    /* Base summary reset so we can control layout precisely */
    details > summary {
        list-style: none; /* remove marker spacing */
        cursor: pointer;
        padding: 0;
        margin: 0;
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 0;
        /* Ensure summary allows child glows/shadows to show outside its box */
        overflow: visible;
    }

    /* Hide the default disclosure triangle across browsers */
    details > summary::-webkit-details-marker,
    details > summary::marker {
        display: none;
    }

    /* Force the tag-list inside the summary to be a single non-wrapping row */
    details > summary .tag-list {
        display: flex;
        flex-wrap: nowrap;        /* keep items in a single row */
        gap: var(--tag-list-summary-gap);
        align-items: center;
        /* Allow overflow so box-shadows and glows aren't clipped by a scroll container's rectangle */
        overflow: visible;
        padding: 0;
        margin: 0;
    }

    /* Inner scroll wrapper: enables horizontal scrolling when needed while providing
       vertical padding to prevent glows from being clipped by the scroller's box. */
    details > summary .tag-list .tag-scroll {
        display: flex;
        gap: var(--tag-list-summary-gap);
        align-items: center;
        flex-wrap: nowrap;        /* keep items in a single row inside the scroller */
        overflow-x: auto;        /* allow horizontal scrolling on small viewports */
        overflow-y: visible;     /* try to avoid vertical clipping where possible */
        -webkit-overflow-scrolling: touch;
        /* Increased vertical padding so box-shadow / glow has room to render outside
           the tag content without being clipped by the scroller's rectangle. Also
           add horizontal padding so tag shadows don't overflow the scroller's left/right edges. */
        padding: var(--tag-list-scroll-padding);
        margin: 0;
    }

    /* When the details are expanded, present the following tag-list as a
       full-width panel below the summary row */
    details > .tag-list {
        margin-top: 0.6rem;
        display: flex;
        flex-wrap: wrap;
        gap: var(--card-gap);
        list-style: none;
        padding: 0;
    }


    /* Consolidated: role-colored tag-links using scoped variables */
    .tag-link:is(.author, .maintainer, .contributor) {
        box-shadow: 0 0 10px var(--current-role-color);
    }

    .tag-link.active {
        background-color: var(--orange-active);
    }

    /* Consolidated: active role-colored tag-links using scoped variables */
    .tag-link:is(.author, .maintainer, .contributor).active {
        background-color: var(--current-role-color);
    }

    .tag-link.active .tag {
        background-color: var(--orange-active);
        color: var(--white);
        border: var(--border-width-tag) solid var(--orange-active-solid);
        margin-left: 0;
        margin-right: 1.5rem;
    }

    /* Consolidated: active role-colored inner tags using scoped variables */
    .tag-link:is(.author, .maintainer, .contributor).active .tag:is(.author, .maintainer, .contributor) {
        background-color: var(--current-role-color);
        color: var(--white);
        border: var(--border-width-tag) solid var(--current-role-solid);
        margin-left: 0;
        margin-right: 1.5rem;
    }

    .count {
        position: absolute;
        top: var(--count-top);
        font-size: var(--font-size-xs);
        font-weight: var(--font-weight-normal);
        padding: var(--count-padding);
        color: var(--text-color);
    }

    .count.left {
        left: 0;
        opacity: 1;
        z-index: 1;
    }

    .count.right {
        right: 0;
        opacity: 1;
        z-index: -1;
    }

    .tag-link.active .count.left {
        opacity: 0;
        z-index: -1;
    }

    .tag-link.active .count.right {
        opacity: 1;
        color: var(--white);
        z-index: 1;
    }
}

/* Filters container: lay out the details summaries in a single horizontal row */
.filters {
    position: relative; /* positioning context for absolute panels */
    display: flex;
    gap: 0.75rem;
    align-items: flex-start;
    justify-content: flex-start;
    /* keep filters visually grouped from surrounding content */
    margin-bottom: var(--filters-margin-bottom);
    overflow: visible; /* ensure overlays and shadows are visible */
    /* Allow the filters row to wrap to multiple lines on narrow viewports so it
       doesn't push the page horizontally. This mirrors the behavior used in the
       h1 role filters and improves mobile UX. */
    flex-wrap: wrap;
}

/* Each <details> becomes a compact flex item so its <summary> sits inline in the row */
.filters > details {
    /* size to content, allow shrinking so long summaries won't force overflow */
    flex: 0 1 auto;
    min-width: 0; /* enable flex children to shrink properly */
    position: relative; /* positioning context for its absolutely-positioned panel */
}

/* Hide the default disclosure marker for filter details */
.filters > details > summary {
    list-style: none;
}

.filters > details > summary::-webkit-details-marker,
.filters > details > summary::marker {
    display: none;
}

/* Small tweak: allow the summary's inline tag-list to wrap if the available
   width is very small. By default we keep horizontal scrolling, but allow a
   fallback to wrap on extremely narrow screens. */
.filters > details > summary .tag-list {
    display: flex;
    flex-wrap: wrap;
    gap: var(--tag-list-summary-gap);
    align-items: center;
    padding: 0;
    margin: 0;
    overflow-x: visible;        /* remove horizontal scrolling to allow wrapping */
    overflow-y: visible;         /* ensure vertical overflow (e.g. box-shadow) isn't clipped */
    -webkit-overflow-scrolling: touch;
}

/* Panels: position as overlays so opening them won't push content down */
.filters > details > .tag-list {
    position: absolute; /* overlay other content */
    top: calc(100% + 0.6rem);
    left: 0;
    /* responsive width: never wider than the page column but allow space for multiple columns */
    width: min(48rem, calc(100vw - 2rem));
    background: var(--muted-bg);
    border-radius: var(--border-radius-panel);
    box-shadow: var(--shadow-panel);
    z-index: var(--z-filter-panel);

    /* Use a responsive grid so several tags can sit on a row */
    display: grid; /* changed from flex to grid */
    grid-template-columns: repeat(auto-fit, minmax(var(--filter-panel-col-min), 1fr));
    column-gap: var(--filter-panel-gap);
    row-gap: var(--filter-panel-gap);
    list-style: none;
    padding: var(--filter-panel-padding); /* consistent internal padding */
    box-sizing: border-box;

    /* viewport-safe: don't exceed 60% of viewport height; allow internal scrolling */
    max-height: var(--filter-panel-max-height);
    overflow: auto; /* allow internal scrolling when needed */
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
}

/* Right-aligned variant: used when JS decides panel would overflow the right edge */
.filters > details.align-right > .tag-list {
    left: auto;
    right: 0;
}

/* Show overlay when the details element is open */
.filters > details[open] > .tag-list {
    display: grid;
}

/* On very small viewports, reduce the min column width so at least two columns can fit */
@media (max-width: 36rem) {
    .filters > details > .tag-list {
        grid-template-columns: repeat(auto-fit, minmax(var(--filter-panel-col-min-mobile), 1fr));
    }
}

/* Ensure the decorative summary-control caret and spacing remain as before */
.filters > details > summary .summary-control {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

/* Add caret indicator after the summary-control content */
.filters > details > summary .summary-control::after {
    content: "";
    display: inline-block;
    width: 0;
    height: 0;
    border-left: var(--caret-size) solid transparent;
    border-right: var(--caret-size) solid transparent;
    border-top: var(--caret-size) solid currentColor;
    transition: transform var(--transition-caret);
    margin-left: var(--caret-margin);
}

/* Rotate caret when open */
.filters > details[open] > summary .summary-control::after {
    transform: rotate(180deg);
}

/* When any tag inside a details is active, give the summary-control the same
   'active' treatment so it reads like the filter pills. The JS toggles
   `has-active-filter` on the <details>. */
.filters > details.has-active-filter > summary .summary-control {
    /* Match the active pill visuals driven by the --orange-active variables */
    display: inline-flex; /* ensure same layout as .tag-link */
    align-items: center;
    gap: 0.5rem;
    /* Remove outer padding — let the inner .tag provide the vertical sizing so
       the summary-control doesn't change the row height when toggled. */
    padding: 0;
    box-sizing: border-box;
    border-radius: var(--border-radius-pill);
    color: var(--white);
    text-decoration: none;
    vertical-align: middle;
    /* two-tone border + inner background like .tag-link.active */
    border: var(--border-width-tag) solid transparent;
    background-image: linear-gradient(var(--orange-active), var(--orange-active)), linear-gradient(to bottom, var(--orange-top-active), var(--orange-bottom-active));
    background-origin: border-box;
    background-clip: padding-box, border-box;
    /* previously used a glow here which caused square cutoff issues; remove it */
    box-shadow: none;
}

/* Make the inner .tag behave exactly like the .tag inside a .tag-link.active */
.filters > details.has-active-filter > summary .summary-control .tag {
    background-color: var(--orange-active);
    color: var(--white);
    border: var(--border-width-tag) solid var(--orange-active-solid);
    margin-left: 0;          /* slide left into the host pill */
    margin-right: 1.5rem;    /* same spacing as active tags */
    /* ensure the same transition exists so it animates like the real tag */
    transition: var(--transition-tag-margin), background-color var(--transition-tag-colors);
    /* Match the inner padding used by regular .tag so sizing is consistent */
    padding: var(--tag-padding-filter);
    border-radius: var(--border-radius-pill);
}

/* Counts should swap like on .tag-link.active */
.filters > details.has-active-filter > summary .summary-control .count.left {
    opacity: 0;
    z-index: -1;
}
.filters > details.has-active-filter > summary .summary-control .count.right {
    opacity: 1;
    color: var(--white);
    z-index: 1;
}

/* Ensure caret color follows the summary-control color (often white on active) */
.filters > details.has-active-filter > summary .summary-control::after {
    border-top-color: currentColor;
}

/* Remove focus treatment on summary controls to avoid square/cornered rings that
   can be clipped by scrollers. This intentionally clears both outline and box-shadow
   for focused summary elements (active and non-active). */
.filters > details > summary:focus,
.filters > details > summary:focus-visible {
    outline: none;
    box-shadow: none;
}

/* Also ensure any focus rules targeting the active summary-control don't add a
   glow — keep active visuals but remove focus-generated box-shadow. */
.filters > details.has-active-filter > summary:focus-visible .summary-control,
.filters > details.has-active-filter > summary:focus .summary-control {
    outline: none;
    box-shadow: none;
}
