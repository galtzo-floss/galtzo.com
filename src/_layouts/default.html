---
---
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="color-scheme" content="light dark">
  <title><%= (page.respond_to?(:data) && page.data["title"]) || site.metadata.title %></title>
  <!-- Initialize theme before CSS to reduce flash -->
  <script>
    (function() {
      try {
        var stored = localStorage.getItem('theme');
        if (stored === 'light' || stored === 'dark') {
          document.documentElement.setAttribute('data-theme', stored);
        } else {
          document.documentElement.removeAttribute('data-theme');
        }
      } catch (e) { /* ignore */ }
    })();
  </script>
  <link rel="stylesheet" href="/assets/styles.css">
</head>
<body class="<%= page.data['body_class'] || '' %>">
  <header>
    <nav>
      <a href="https://discord.gg/3qme4XHNKN" target="_blank" rel="noopener">
        <img src="https://logos.galtzo.com/assets/images/galtzo-floss/avatar-128px-blank.svg" alt="Galtzo FLOSS Logo by Aboling0, CC BY-SA 4.0">
      </a>
      <a href="https://docs.google.com/document/d/1H9fYtkMFmnkQO1sucrFPt5E3dvhozgVtI31LgpNLmJ4/pub" class="text-link" target="_blank" rel="noopener">CV</a>
      <a href="https://www.linkedin.com/in/peterboling" class="text-link" target="_blank" rel="noopener">LinkedIn</a>
      <a href="https://dev.to/galtzo" class="text-link" target="_blank" rel="noopener">Dev.to</a>
      <a href="https://ruby.social/@galtzo" class="text-link" target="_blank" rel="noopener">Ruby.social</a>
      <a href="https://discord.gg/3qme4XHNKN" class="text-link" target="_blank" rel="noopener">Discord</a>
    </nav>
    <button id="theme-toggle" class="theme-toggle" type="button" aria-label="Toggle theme" title="Toggle theme">üåô</button>
  </header>

  <main>
    <%= yield %>
  </main>

  <footer>
    <p>&copy; <%= Time.now.strftime("%Y") %> <%= site.metadata.title %></p>
    <p>built by <a href="https://ruby.social/@galtzo" class="text-link" target="_blank" rel="noopener">Peter Boling</a> with üíú in <a href="https://www.bridgetownrb.com/" class="text-link" target="_blank" rel="noopener">Bridgetown</a></p>
  </footer>

  <script>
    (function() {
      var btn = document.getElementById('theme-toggle');
      if (!btn) return;

      function systemPrefersDark() {
        return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      }

      function getOverride() {
        try { return localStorage.getItem('theme'); } catch(e) { return null; }
      }

      function setOverride(val) {
        try {
          if (val === 'light' || val === 'dark') {
            localStorage.setItem('theme', val);
            document.documentElement.setAttribute('data-theme', val);
          } else {
            localStorage.removeItem('theme');
            document.documentElement.removeAttribute('data-theme');
          }
        } catch(e) { /* ignore */ }
        updateButton();
      }

      function effectiveTheme() {
        var override = getOverride();
        if (override === 'light' || override === 'dark') return override;
        return systemPrefersDark() ? 'dark' : 'light';
      }

      function updateButton() {
        var eff = effectiveTheme();
        if (eff === 'dark') {
          btn.textContent = '‚òÄÔ∏è';
          btn.setAttribute('aria-label', 'Switch to light theme');
          btn.setAttribute('title', 'Switch to light theme (Shift-click for System)');
        } else {
          btn.textContent = 'üåô';
          btn.setAttribute('aria-label', 'Switch to dark theme');
          btn.setAttribute('title', 'Switch to dark theme (Shift-click for System)');
        }
      }

      btn.addEventListener('click', function(e) {
        if (e && (e.shiftKey || e.ctrlKey || e.metaKey)) {
          // Clear override, return to system default
          try { localStorage.removeItem('theme'); } catch(_) {}
          document.documentElement.removeAttribute('data-theme');
          updateButton();
          return;
        }
        var current = effectiveTheme();
        var next = current === 'dark' ? 'light' : 'dark';
        setOverride(next);
      });

      // Keep in sync if the OS theme changes and no override is set
      if (window.matchMedia) {
        var mq = window.matchMedia('(prefers-color-scheme: dark)');
        mq.addEventListener && mq.addEventListener('change', function() {
          if (!getOverride()) updateButton();
        });
      }

      updateButton();
    })();
  </script>

  <!-- Site behavior: filtering is in /assets/filter.js -->
  <script src="/assets/filter.js"></script>
</body>
</html>
